{"version":3,"file":"vue.js","sources":["../src/observe/arr.js","../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组方法\r\n\r\n// 1) 获取原来数组的方法\r\nlet oldArrayProtoMethods = Array.prototype\r\n// 2) 继承\r\nexport let ArrayMethods = Object.create(oldArrayProtoMethods)\r\n// 3）函数劫持\r\nlet methods = ['push', 'pop', 'unshift', 'shift', 'splice', 'sort', 'reverse']\r\n\r\nmethods.forEach((method) => {\r\n  ArrayMethods[method] = function (...args) {\r\n    console.log('数组劫持', args)\r\n    const result = oldArrayProtoMethods[method].apply(this, args)\r\n    // 对数组中新增的数据 进行劫持\r\n    let inserted //新增的内容\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n    let ob = this.__ob__\r\n    if (inserted) {\r\n      // 对新增的内容进行劫持\r\n      ob.observeArray(inserted)\r\n    }\r\n    return result\r\n  }\r\n})\r\n","import { ArrayMethods } from './arr'\r\nexport function observer(data) {\r\n  if (typeof data !== 'object' || data === null) {\r\n    // data不是对象或者data为空 不劫持\r\n    return data\r\n  }\r\n\r\n  console.log('劫持data:', data)\r\n  return new Observer(data)\r\n}\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // 给 value 添加一个属性\r\n    Object.defineProperty(value, '__ob__', {\r\n      enumerable: false, //不可枚举\r\n      value: this\r\n    })\r\n    // value.__ob__ = this //副作用 给数据加了一个标识上有__ob__ 则说明这个属性被观测过\r\n\r\n    // 判断是不是数组\r\n    if (Array.isArray(value)) {\r\n      console.log('数组', value)\r\n      // 重写数组 的部分方法\r\n      value.__proto__ = ArrayMethods\r\n      // 数组里面包含对象\r\n      this.observeArray(value) //[{a:1}]\r\n    } else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n  walk(data) {\r\n    let keys = Object.keys(data)\r\n    // console.log('keys', keys)\r\n    for (let i = 0; i < keys.length; i++) {\r\n      const key = keys[i]\r\n      const value = data[key]\r\n      // 对每一个属性进行劫持\r\n      defineReactive(data, key, value)\r\n    }\r\n  }\r\n  observeArray(arr) {\r\n    for (let i = 0; i < arr.length; i++) {\r\n      observer(arr[i])\r\n    }\r\n  }\r\n}\r\n// 对对象中的属性进行劫持\r\nfunction defineReactive(data, key, value) {\r\n  observer(value) //深度递归劫持\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      console.log('获取', key)\r\n      return value\r\n    },\r\n    set(newVal) {\r\n      console.log('设置', newVal)\r\n      if (newVal === value) return\r\n      observer(newVal) //对设置的值 进行劫持\r\n      value = newVal\r\n    }\r\n  })\r\n}\r\n","import { observer } from './observe/index'\r\nexport function initState(vm) {\r\n  let ops = vm.$options\r\n  // console.log('ops', ops)\r\n  if (ops.data) {\r\n    initData(vm)\r\n  }\r\n  if (ops.props) {\r\n    initProps()\r\n  }\r\n  if (ops.watch) {\r\n    initWatch()\r\n  }\r\n  if (ops.computed) {\r\n    initComputed()\r\n  }\r\n  if (ops.methods) {\r\n    initMethods()\r\n  }\r\n}\r\n\r\nfunction initData(vm) {\r\n  // console.log('vm:data初始化', vm)\r\n  let data = vm.$options.data\r\n  // 对象或者函数\r\n  if (typeof data === 'object' && data !== null) {\r\n    data = data\r\n  } else if (typeof data === 'function') {\r\n    data = data.call(vm)\r\n  } else {\r\n    console.error('data type error')\r\n    return false\r\n  }\r\n  vm._data = data\r\n\r\n  // 将data上的属性代理到实例上 vm.msg = vm._data.msg\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n  // 对data数据进行劫持\r\n  observer(data)\r\n}\r\n\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal\r\n    }\r\n  })\r\n}\r\n\r\nfunction initProps() {}\r\nfunction initWatch() {}\r\nfunction initComputed() {}\r\nfunction initMethods() {}\r\n","import { initState } from './initState'\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    // console.log('options', options)\r\n    let vm = this\r\n    vm.$options = options\r\n    // 初始化状态\r\n    initState(vm)\r\n  }\r\n}\r\n","import { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n  // 初始化\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue\r\n"],"names":["oldArrayProtoMethods","Array","prototype","ArrayMethods","Object","create","methods","forEach","method","args","console","log","result","apply","inserted","slice","ob","__ob__","observeArray","observer","data","Observer","value","defineProperty","enumerable","isArray","__proto__","walk","keys","i","length","key","defineReactive","arr","get","set","newVal","initState","vm","ops","$options","initData","props","watch","computed","call","error","_data","proxy","source","initMixin","Vue","_init","options"],"mappings":"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"}