{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayMethods = Array.prototype\r\n\r\nexport let ArrayMethods = Object.create(oldArrayMethods)\r\n\r\nlet methods = ['push', 'pop', 'unshift', 'shift', 'splice', 'sort', 'reverse']\r\n\r\nfor (let method of methods) {\r\n  ArrayMethods[method] = function (...args) {\r\n    let result = oldArrayMethods[method].apply(this, args)\r\n    let inserted // 新增的值\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n    // console.log(this)\r\n    if (inserted) {\r\n      //对新增的内容进行劫持\r\n      this.__ob__.observeArray(inserted)\r\n    }\r\n    return result\r\n  }\r\n}\r\n","import { ArrayMethods } from './array'\r\n\r\nexport function observer(data) {\r\n  if (data === null || typeof data !== 'object') {\r\n    // data不是对象或者data为空 不劫持\r\n    return data\r\n  }\r\n  console.log('要进行劫持的数据', data)\r\n  return new Observer(data)\r\n}\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // 给 value 添加一个属性\r\n    Object.defineProperty(value, '__ob__', {\r\n      enumerable: false, //不可枚举\r\n      value: this\r\n    })\r\n    if (Array.isArray(value)) {\r\n      // 重写数组 的部分方法\r\n      value.__proto__ = ArrayMethods\r\n      this.observeArray(value)\r\n    } else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n  walk(data) {\r\n    let keys = Object.keys(data)\r\n    for (let i = 0; i < keys.length; i++) {\r\n      // 对data中的每一个属性进行劫持\r\n      const key = keys[i]\r\n      defineReactive(data, key, data[key])\r\n    }\r\n  }\r\n  observeArray(data) {\r\n    for (let i = 0; i < data.length; i++) {\r\n      observer(data[i])\r\n    }\r\n  }\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n  observer(value)\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      console.log('获取key', key, value)\r\n      return value\r\n    },\r\n    set(newVal) {\r\n      console.log('设置key', key, newVal)\r\n      if (value === newVal) return\r\n      observer(newVal) //对设置的值 进行劫持\r\n      value = newVal\r\n    }\r\n  })\r\n}\r\n","import { observer } from './observe/index'\r\n\r\nexport function initState(vm) {\r\n  let options = vm.$options\r\n  console.log(vm)\r\n  if (options.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  console.log('刚要初始化的data', data)\r\n  if (data !== null && typeof data === 'object') {\r\n    data = data\r\n  } else if (typeof data === 'function') {\r\n    data = data.call(vm)\r\n  } else {\r\n    console.error('data type err')\r\n    return false\r\n  }\r\n  vm._data = data\r\n\r\n  console.log('处理后的data', data)\r\n\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n\r\n  // 对data中的数据进行劫持\r\n  observer(data)\r\n}\r\n\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal\r\n    }\r\n  })\r\n}\r\n","import { initState } from './initState'\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype.__init = function (options) {\r\n    let vm = this\r\n    vm.$options = options\r\n    initState(vm)\r\n  }\r\n}\r\n","import { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n  this.__init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue\r\n"],"names":["oldArrayMethods","Array","prototype","ArrayMethods","Object","create","methods","method","args","result","apply","inserted","slice","__ob__","observeArray","observer","data","console","log","Observer","value","defineProperty","enumerable","isArray","__proto__","walk","keys","i","length","key","defineReactive","get","set","newVal","initState","vm","options","$options","initData","call","error","_data","proxy","source","initMixin","Vue","__init"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA,IAAIA,eAAe,GAAGC,KAAK,CAACC,SAA5B,CAAA;EAEO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcL,eAAd,CAAnB,CAAA;EAEP,IAAIM,OAAO,GAAG,CAAC,MAAD,EAAS,KAAT,EAAgB,SAAhB,EAA2B,OAA3B,EAAoC,QAApC,EAA8C,MAA9C,EAAsD,SAAtD,CAAd,CAAA;;;EAEK,EAAA,IAAIC,MAAM,GAAV,QAAA,CAAA,EAAA,CAAA,CAAA;;EACHJ,EAAAA,YAAY,CAACI,MAAD,CAAZ,GAAuB,YAAmB;EAAA,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAANC,IAAM,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;QAANA,IAAM,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EACxC,IAAA,IAAIC,MAAM,GAAGT,eAAe,CAACO,MAAD,CAAf,CAAwBG,KAAxB,CAA8B,IAA9B,EAAoCF,IAApC,CAAb,CAAA;MACA,IAAIG,QAAJ,CAFwC;;EAGxC,IAAA,QAAQJ,MAAR;EACE,MAAA,KAAK,MAAL,CAAA;EACA,MAAA,KAAK,SAAL;EACEI,QAAAA,QAAQ,GAAGH,IAAX,CAAA;EACA,QAAA,MAAA;;EACF,MAAA,KAAK,QAAL;EACEG,QAAAA,QAAQ,GAAGH,IAAI,CAACI,KAAL,CAAW,CAAX,CAAX,CAAA;EACA,QAAA,MAAA;EAPJ,KAHwC;;;EAexC,IAAA,IAAID,QAAJ,EAAc;EACZ;EACA,MAAA,IAAA,CAAKE,MAAL,CAAYC,YAAZ,CAAyBH,QAAzB,CAAA,CAAA;EACD,KAAA;;EACD,IAAA,OAAOF,MAAP,CAAA;KAnBF,CAAA;;;EADF,KAAA,IAAA,EAAA,GAAA,CAAA,EAAA,QAAA,GAAmBH,OAAnB,EAA4B,EAAA,GAAA,QAAA,CAAA,MAAA,EAAA,EAAA,EAAA,EAAA;EAAA,EAAA,KAAA,EAAA,CAAA;EAsB3B;;EC1BM,SAASS,QAAT,CAAkBC,IAAlB,EAAwB;IAC7B,IAAIA,IAAI,KAAK,IAAT,IAAiB,QAAOA,IAAP,CAAA,KAAgB,QAArC,EAA+C;EAC7C;EACA,IAAA,OAAOA,IAAP,CAAA;EACD,GAAA;;EACDC,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBF,IAAxB,CAAA,CAAA;EACA,EAAA,OAAO,IAAIG,QAAJ,CAAaH,IAAb,CAAP,CAAA;EACD,CAAA;;MAEKG;EACJ,EAAA,SAAA,QAAA,CAAYC,KAAZ,EAAmB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EACjB;EACAhB,IAAAA,MAAM,CAACiB,cAAP,CAAsBD,KAAtB,EAA6B,QAA7B,EAAuC;EACrCE,MAAAA,UAAU,EAAE,KADyB;EAClB;EACnBF,MAAAA,KAAK,EAAE,IAAA;OAFT,CAAA,CAAA;;EAIA,IAAA,IAAInB,KAAK,CAACsB,OAAN,CAAcH,KAAd,CAAJ,EAA0B;EACxB;QACAA,KAAK,CAACI,SAAN,GAAkBrB,YAAlB,CAAA;QACA,IAAKW,CAAAA,YAAL,CAAkBM,KAAlB,CAAA,CAAA;EACD,KAJD,MAIO;QACL,IAAKK,CAAAA,IAAL,CAAUL,KAAV,CAAA,CAAA;EACD,KAAA;EACF,GAAA;;;;EACD,IAAA,KAAA,EAAA,SAAA,IAAA,CAAKJ,IAAL,EAAW;EACT,MAAA,IAAIU,IAAI,GAAGtB,MAAM,CAACsB,IAAP,CAAYV,IAAZ,CAAX,CAAA;;EACA,MAAA,KAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,IAAI,CAACE,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;EACpC;EACA,QAAA,IAAME,GAAG,GAAGH,IAAI,CAACC,CAAD,CAAhB,CAAA;UACAG,cAAc,CAACd,IAAD,EAAOa,GAAP,EAAYb,IAAI,CAACa,GAAD,CAAhB,CAAd,CAAA;EACD,OAAA;EACF,KAAA;;;EACD,IAAA,KAAA,EAAA,SAAA,YAAA,CAAab,IAAb,EAAmB;EACjB,MAAA,KAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGX,IAAI,CAACY,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;EACpCZ,QAAAA,QAAQ,CAACC,IAAI,CAACW,CAAD,CAAL,CAAR,CAAA;EACD,OAAA;EACF,KAAA;;;;;;EAGH,SAASG,cAAT,CAAwBd,IAAxB,EAA8Ba,GAA9B,EAAmCT,KAAnC,EAA0C;IACxCL,QAAQ,CAACK,KAAD,CAAR,CAAA;EACAhB,EAAAA,MAAM,CAACiB,cAAP,CAAsBL,IAAtB,EAA4Ba,GAA5B,EAAiC;EAC/BE,IAAAA,GAD+B,EACzB,SAAA,GAAA,GAAA;EACJd,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBW,GAArB,EAA0BT,KAA1B,CAAA,CAAA;EACA,MAAA,OAAOA,KAAP,CAAA;OAH6B;MAK/BY,GAL+B,EAAA,SAAA,GAAA,CAK3BC,MAL2B,EAKnB;EACVhB,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBW,GAArB,EAA0BI,MAA1B,CAAA,CAAA;QACA,IAAIb,KAAK,KAAKa,MAAd,EAAsB,OAAA;EACtBlB,MAAAA,QAAQ,CAACkB,MAAD,CAAR,CAHU;;EAIVb,MAAAA,KAAK,GAAGa,MAAR,CAAA;EACD,KAAA;KAVH,CAAA,CAAA;EAYD;;ECrDM,SAASC,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B,EAAA,IAAIC,OAAO,GAAGD,EAAE,CAACE,QAAjB,CAAA;IACApB,OAAO,CAACC,GAAR,CAAYiB,EAAZ,CAAA,CAAA;;IACA,IAAIC,OAAO,CAACpB,IAAZ,EAAkB;MAChBsB,QAAQ,CAACH,EAAD,CAAR,CAAA;EACD,GAAA;EACF,CAAA;;EAED,SAASG,QAAT,CAAkBH,EAAlB,EAAsB;EACpB,EAAA,IAAInB,IAAI,GAAGmB,EAAE,CAACE,QAAH,CAAYrB,IAAvB,CAAA;EACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BF,IAA1B,CAAA,CAAA;;IACA,IAAIA,IAAI,KAAK,IAAT,IAAiB,QAAOA,IAAP,CAAA,KAAgB,QAArC,EAA+C;EAC7CA,IAAAA,IAAI,GAAGA,IAAP,CAAA;EACD,GAFD,MAEO,IAAI,OAAOA,IAAP,KAAgB,UAApB,EAAgC;EACrCA,IAAAA,IAAI,GAAGA,IAAI,CAACuB,IAAL,CAAUJ,EAAV,CAAP,CAAA;EACD,GAFM,MAEA;MACLlB,OAAO,CAACuB,KAAR,CAAc,eAAd,CAAA,CAAA;EACA,IAAA,OAAO,KAAP,CAAA;EACD,GAAA;;IACDL,EAAE,CAACM,KAAH,GAAWzB,IAAX,CAAA;EAEAC,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBF,IAAxB,CAAA,CAAA;;EAEA,EAAA,KAAK,IAAIa,GAAT,IAAgBb,IAAhB,EAAsB;EACpB0B,IAAAA,KAAK,CAACP,EAAD,EAAK,OAAL,EAAcN,GAAd,CAAL,CAAA;EACD,GAjBmB;;;IAoBpBd,QAAQ,CAACC,IAAD,CAAR,CAAA;EACD,CAAA;;EAED,SAAS0B,KAAT,CAAeP,EAAf,EAAmBQ,MAAnB,EAA2Bd,GAA3B,EAAgC;EAC9BzB,EAAAA,MAAM,CAACiB,cAAP,CAAsBc,EAAtB,EAA0BN,GAA1B,EAA+B;EAC7BE,IAAAA,GAD6B,EACvB,SAAA,GAAA,GAAA;EACJ,MAAA,OAAOI,EAAE,CAACQ,MAAD,CAAF,CAAWd,GAAX,CAAP,CAAA;OAF2B;MAI7BG,GAJ6B,EAAA,SAAA,GAAA,CAIzBC,MAJyB,EAIjB;EACVE,MAAAA,EAAE,CAACQ,MAAD,CAAF,CAAWd,GAAX,IAAkBI,MAAlB,CAAA;EACD,KAAA;KANH,CAAA,CAAA;EAQD;;ECxCM,SAASW,SAAT,CAAmBC,GAAnB,EAAwB;EAC7BA,EAAAA,GAAG,CAAC3C,SAAJ,CAAc4C,MAAd,GAAuB,UAAUV,OAAV,EAAmB;MACxC,IAAID,EAAE,GAAG,IAAT,CAAA;MACAA,EAAE,CAACE,QAAH,GAAcD,OAAd,CAAA;MACAF,SAAS,CAACC,EAAD,CAAT,CAAA;KAHF,CAAA;EAKD;;ECND,SAASU,GAAT,CAAaT,OAAb,EAAsB;IACpB,IAAKU,CAAAA,MAAL,CAAYV,OAAZ,CAAA,CAAA;EACD,CAAA;;EAEDQ,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}